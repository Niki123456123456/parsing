use crate::rules::{grammar::Grammar, n, r, rf};

use super::testing::{test_achars, test_nachars};

pub fn grammar() -> Grammar {
    let mut grammar = Grammar::default();

    // characters
    grammar.atomic("newline", r("\u{000A}"));
    grammar.atomic("unicode_char", n(rf("newline")));
    grammar.atomic(
        "unicode_letter",
        r('\u{0041}'..'\u{005A}')
            | r('\u{0061}'..'\u{007A}')
            | r("\u{00AA}")
            | r("\u{00B5}")
            | r("\u{00BA}")
            | r('\u{00C0}'..'\u{00D6}')
            | r('\u{00D8}'..'\u{00F6}')
            | r('\u{00F8}'..'\u{021F}')
            | r('\u{0222}'..'\u{0233}')
            | r('\u{0250}'..'\u{02AD}')
            | r('\u{02B0}'..'\u{02B8}')
            | r('\u{02BB}'..'\u{02C1}')
            | r('\u{02D0}'..'\u{02D1}')
            | r('\u{02E0}'..'\u{02E4}')
            | r("\u{02EE}")
            | r("\u{037A}")
            | r("\u{0386}")
            | r('\u{0388}'..'\u{038A}')
            | r("\u{038C}")
            | r('\u{038E}'..'\u{03A1}')
            | r('\u{03A3}'..'\u{03CE}')
            | r('\u{03D0}'..'\u{03D7}')
            | r('\u{03DA}'..'\u{03F3}')
            | r('\u{0400}'..'\u{0481}')
            | r('\u{048C}'..'\u{04C4}')
            | r('\u{04C7}'..'\u{04C8}')
            | r('\u{04CB}'..'\u{04CC}')
            | r('\u{04D0}'..'\u{04F5}')
            | r('\u{04F8}'..'\u{04F9}')
            | r('\u{0531}'..'\u{0556}')
            | r("\u{0559}")
            | r('\u{0561}'..'\u{0587}')
            | r('\u{05D0}'..'\u{05EA}')
            | r('\u{05F0}'..'\u{05F2}')
            | r('\u{0621}'..'\u{063A}')
            | r('\u{0640}'..'\u{064A}')
            | r('\u{0671}'..'\u{06D3}')
            | r("\u{06D5}")
            | r('\u{06E5}'..'\u{06E6}')
            | r('\u{06FA}'..'\u{06FC}')
            | r("\u{0710}")
            | r('\u{0712}'..'\u{072C}')
            | r('\u{0780}'..'\u{07A5}')
            | r('\u{0905}'..'\u{0939}')
            | r("\u{093D}")
            | r("\u{0950}")
            | r('\u{0958}'..'\u{0961}')
            | r('\u{0985}'..'\u{098C}')
            | r('\u{098F}'..'\u{0990}')
            | r('\u{0993}'..'\u{09A8}')
            | r('\u{09AA}'..'\u{09B0}')
            | r("\u{09B2}")
            | r('\u{09B6}'..'\u{09B9}')
            | r('\u{09DC}'..'\u{09DD}')
            | r('\u{09DF}'..'\u{09E1}')
            | r('\u{09F0}'..'\u{09F1}')
            | r('\u{0A05}'..'\u{0A0A}')
            | r('\u{0A0F}'..'\u{0A10}')
            | r('\u{0A13}'..'\u{0A28}')
            | r('\u{0A2A}'..'\u{0A30}')
            | r('\u{0A32}'..'\u{0A33}')
            | r('\u{0A35}'..'\u{0A36}')
            | r('\u{0A38}'..'\u{0A39}')
            | r('\u{0A59}'..'\u{0A5C}')
            | r("\u{0A5E}")
            | r('\u{0A72}'..'\u{0A74}')
            | r('\u{0A85}'..'\u{0A8B}')
            | r("\u{0A8D}")
            | r('\u{0A8F}'..'\u{0A91}')
            | r('\u{0A93}'..'\u{0AA8}')
            | r('\u{0AAA}'..'\u{0AB0}')
            | r('\u{0AB2}'..'\u{0AB3}')
            | r('\u{0AB5}'..'\u{0AB9}')
            | r("\u{0ABD}")
            | r("\u{0AD0}")
            | r("\u{0AE0}")
            | r('\u{0B05}'..'\u{0B0C}')
            | r('\u{0B0F}'..'\u{0B10}')
            | r('\u{0B13}'..'\u{0B28}')
            | r('\u{0B2A}'..'\u{0B30}')
            | r('\u{0B32}'..'\u{0B33}')
            | r('\u{0B36}'..'\u{0B39}')
            | r("\u{0B3D}")
            | r('\u{0B5C}'..'\u{0B5D}')
            | r('\u{0B5F}'..'\u{0B61}')
            | r('\u{0B85}'..'\u{0B8A}')
            | r('\u{0B8E}'..'\u{0B90}')
            | r('\u{0B92}'..'\u{0B95}')
            | r('\u{0B99}'..'\u{0B9A}')
            | r("\u{0B9C}")
            | r('\u{0B9E}'..'\u{0B9F}')
            | r('\u{0BA3}'..'\u{0BA4}')
            | r('\u{0BA8}'..'\u{0BAA}')
            | r('\u{0BAE}'..'\u{0BB5}')
            | r('\u{0BB7}'..'\u{0BB9}')
            | r('\u{0C05}'..'\u{0C0C}')
            | r('\u{0C0E}'..'\u{0C10}')
            | r('\u{0C12}'..'\u{0C28}')
            | r('\u{0C2A}'..'\u{0C33}')
            | r('\u{0C35}'..'\u{0C39}')
            | r('\u{0C60}'..'\u{0C61}')
            | r('\u{0C85}'..'\u{0C8C}')
            | r('\u{0C8E}'..'\u{0C90}')
            | r('\u{0C92}'..'\u{0CA8}')
            | r('\u{0CAA}'..'\u{0CB3}')
            | r('\u{0CB5}'..'\u{0CB9}')
            | r("\u{0CDE}")
            | r('\u{0CE0}'..'\u{0CE1}')
            | r('\u{0D05}'..'\u{0D0C}')
            | r('\u{0D0E}'..'\u{0D10}')
            | r('\u{0D12}'..'\u{0D28}')
            | r('\u{0D2A}'..'\u{0D39}')
            | r('\u{0D60}'..'\u{0D61}')
            | r('\u{0D85}'..'\u{0D96}')
            | r('\u{0D9A}'..'\u{0DB1}')
            | r('\u{0DB3}'..'\u{0DBB}')
            | r("\u{0DBD}")
            | r('\u{0DC0}'..'\u{0DC6}')
            | r('\u{0E01}'..'\u{0E30}')
            | r('\u{0E32}'..'\u{0E33}')
            | r('\u{0E40}'..'\u{0E46}')
            | r('\u{0E81}'..'\u{0E82}')
            | r("\u{0E84}")
            | r('\u{0E87}'..'\u{0E88}')
            | r("\u{0E8A}")
            | r("\u{0E8D}")
            | r('\u{0E94}'..'\u{0E97}')
            | r('\u{0E99}'..'\u{0E9F}')
            | r('\u{0EA1}'..'\u{0EA3}')
            | r("\u{0EA5}")
            | r("\u{0EA7}")
            | r('\u{0EAA}'..'\u{0EAB}')
            | r('\u{0EAD}'..'\u{0EB0}')
            | r('\u{0EB2}'..'\u{0EB3}')
            | r('\u{0EBD}'..'\u{0EC4}')
            | r("\u{0EC6}")
            | r('\u{0EDC}'..'\u{0EDD}')
            | r("\u{0F00}")
            | r('\u{0F40}'..'\u{0F6A}')
            | r('\u{0F88}'..'\u{0F8B}')
            | r('\u{1000}'..'\u{1021}')
            | r('\u{1023}'..'\u{1027}')
            | r('\u{1029}'..'\u{102A}')
            | r('\u{1050}'..'\u{1055}')
            | r('\u{10A0}'..'\u{10C5}')
            | r('\u{10D0}'..'\u{10F6}')
            | r('\u{1100}'..'\u{1159}')
            | r('\u{115F}'..'\u{11A2}')
            | r('\u{11A8}'..'\u{11F9}')
            | r('\u{1200}'..'\u{1206}')
            | r('\u{1208}'..'\u{1246}')
            | r("\u{1248}")
            | r('\u{124A}'..'\u{124D}')
            | r('\u{1250}'..'\u{1256}')
            | r("\u{1258}")
            | r('\u{125A}'..'\u{125D}')
            | r('\u{1260}'..'\u{1286}')
            | r("\u{1288}")
            | r('\u{128A}'..'\u{128D}')
            | r('\u{1290}'..'\u{12AE}')
            | r("\u{12B0}")
            | r('\u{12B2}'..'\u{12B5}')
            | r('\u{12B8}'..'\u{12BE}')
            | r("\u{12C0}")
            | r('\u{12C2}'..'\u{12C5}')
            | r('\u{12C8}'..'\u{12CE}')
            | r('\u{12D0}'..'\u{12D6}')
            | r('\u{12D8}'..'\u{12EE}')
            | r('\u{12F0}'..'\u{130E}')
            | r("\u{1310}")
            | r('\u{1312}'..'\u{1315}')
            | r('\u{1318}'..'\u{131E}')
            | r('\u{1320}'..'\u{1346}')
            | r('\u{1348}'..'\u{135A}')
            | r('\u{13A0}'..'\u{13B0}')
            | r('\u{13B1}'..'\u{13F4}')
            | r('\u{1401}'..'\u{1676}')
            | r('\u{1681}'..'\u{169A}')
            | r('\u{16A0}'..'\u{16EA}')
            | r('\u{1780}'..'\u{17B3}')
            | r('\u{1820}'..'\u{1877}')
            | r('\u{1880}'..'\u{18A8}')
            | r('\u{1E00}'..'\u{1E9B}')
            | r('\u{1EA0}'..'\u{1EE0}')
            | r('\u{1EE1}'..'\u{1EF9}')
            | r('\u{1F00}'..'\u{1F15}')
            | r('\u{1F18}'..'\u{1F1D}')
            | r('\u{1F20}'..'\u{1F39}')
            | r('\u{1F3A}'..'\u{1F45}')
            | r('\u{1F48}'..'\u{1F4D}')
            | r('\u{1F50}'..'\u{1F57}')
            | r("\u{1F59}")
            | r("\u{1F5B}")
            | r("\u{1F5D}")
            | r('\u{1F5F}'..'\u{1F7D}')
            | r('\u{1F80}'..'\u{1FB4}')
            | r('\u{1FB6}'..'\u{1FBC}')
            | r("\u{1FBE}")
            | r('\u{1FC2}'..'\u{1FC4}')
            | r('\u{1FC6}'..'\u{1FCC}')
            | r('\u{1FD0}'..'\u{1FD3}')
            | r('\u{1FD6}'..'\u{1FDB}')
            | r('\u{1FE0}'..'\u{1FEC}')
            | r('\u{1FF2}'..'\u{1FF4}')
            | r('\u{1FF6}'..'\u{1FFC}')
            | r("\u{207F}")
            | r("\u{2102}")
            | r("\u{2107}")
            | r('\u{210A}'..'\u{2113}')
            | r("\u{2115}")
            | r('\u{2119}'..'\u{211D}')
            | r("\u{2124}")
            | r("\u{2126}")
            | r("\u{2128}")
            | r('\u{212A}'..'\u{212D}')
            | r('\u{212F}'..'\u{2131}')
            | r('\u{2133}'..'\u{2139}')
            | r('\u{2160}'..'\u{2183}')
            | r('\u{3005}'..'\u{3007}')
            | r('\u{3021}'..'\u{3029}')
            | r('\u{3031}'..'\u{3035}')
            | r('\u{3038}'..'\u{303A}')
            | r('\u{3041}'..'\u{3094}')
            | r('\u{309D}'..'\u{309E}')
            | r('\u{30A1}'..'\u{30FA}')
            | r('\u{30FC}'..'\u{30FE}')
            | r('\u{3105}'..'\u{312C}')
            | r('\u{3131}'..'\u{318E}')
            | r('\u{31A0}'..'\u{31B7}')
            | r("\u{3400}")
            | r("\u{4DB5}")
            | r("\u{4E00}")
            | r("\u{9FA5}")
            | r('\u{A000}'..'\u{A48C}')
            | r("\u{AC00}")
            | r("\u{D7A3}")
            | r('\u{F900}'..'\u{FA2D}')
            | r('\u{FB00}'..'\u{FB06}')
            | r('\u{FB13}'..'\u{FB17}')
            | r("\u{FB1D}")
            | r('\u{FB1F}'..'\u{FB28}')
            | r('\u{FB2A}'..'\u{FB36}')
            | r('\u{FB38}'..'\u{FB3C}')
            | r("\u{FB3E}")
            | r('\u{FB40}'..'\u{FB41}')
            | r('\u{FB43}'..'\u{FB44}')
            | r('\u{FB46}'..'\u{FBB1}')
            | r('\u{FBD3}'..'\u{FD3D}')
            | r('\u{FD50}'..'\u{FD8F}')
            | r('\u{FD92}'..'\u{FDC7}')
            | r('\u{FDF0}'..'\u{FDFB}')
            | r('\u{FE70}'..'\u{FE72}')
            | r("\u{FE74}")
            | r('\u{FE76}'..'\u{FEFC}')
            | r('\u{FF21}'..'\u{FF3A}')
            | r('\u{FF41}'..'\u{FF5A}')
            | r('\u{FF66}'..'\u{FFBE}')
            | r('\u{FFC2}'..'\u{FFC7}')
            | r('\u{FFCA}'..'\u{FFCF}')
            | r('\u{FFD2}'..'\u{FFD7}')
            | r('\u{FFDA}'..'\u{FFDC}'),
    );
    grammar.atomic(
        "unicode_digit",
        r('\u{0030}'..'\u{0039}')
            | r('\u{0660}'..'\u{0669}')
            | r('\u{06F0}'..'\u{06F9}')
            | r('\u{0966}'..'\u{096F}')
            | r('\u{09E6}'..'\u{09EF}')
            | r('\u{0A66}'..'\u{0A6F}')
            | r('\u{0AE6}'..'\u{0AEF}')
            | r('\u{0B66}'..'\u{0B6F}')
            | r('\u{0BE7}'..'\u{0BEF}')
            | r('\u{0C66}'..'\u{0C6F}')
            | r('\u{0CE6}'..'\u{0CEF}')
            | r('\u{0D66}'..'\u{0D6F}')
            | r('\u{0E50}'..'\u{0E59}')
            | r('\u{0ED0}'..'\u{0ED9}')
            | r('\u{0F20}'..'\u{0F29}')
            | r('\u{1040}'..'\u{1049}')
            | r('\u{1369}'..'\u{1371}')
            | r('\u{17E0}'..'\u{17E9}')
            | r('\u{1810}'..'\u{1819}')
            | r('\u{FF10}'..'\u{FF19}'),
    );

    // letters and digits
    grammar.atomic("letter", rf("unicode_letter") | r("_"));
    grammar.atomic("decimal_digit", r('0'..'9'));
    grammar.atomic("binary_digit", r('0'..'1'));
    grammar.atomic("octal_digit", r('0'..'7'));
    grammar.atomic("hex_digit", r('0'..'9') | r('A'..'F') | r('a'..'f'));
    return grammar;
}

#[test]
fn characters() {
    let grammar = grammar();
    test_achars(&grammar, "newline", "\n");
    test_nachars(&grammar, "newline", "abc");

    test_achars(&grammar, "unicode_char", "abc");
    test_nachars(&grammar, "unicode_char", "\n");

    test_achars(&grammar, "unicode_letter", "abcßöäüÖÄÜ");
    test_nachars(&grammar, "unicode_letter", "\n123");

    test_achars(&grammar, "unicode_digit", "0123456789");
    test_nachars(&grammar, "unicode_digit", "\nabc");
}


